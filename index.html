<html>
	<head>
		<title>Test DidJS</title>
		<style>
			#main-div {
		     width: 400px;
		     height:330px;
		     margin: 0px auto;
    		 vertical-align: middle;
		   }
		</style>
		<script type="text/javascript" src="src/Renderer/Renderer.js" ></script>
		<script type="text/javascript" src="src/Collision/CollisionManager.js" ></script>
		<script type="text/javascript" src="src/Game/Scene.js" ></script>
		<script type="text/javascript" src="src/Game/GameObjects.js" ></script>
	</head>
	<body onload='drawScene()'>
		<div id='main-div'>
			<canvas id="mycanvas" width="400" height="330" style="border:1px solid #000;">
				Your browser does not support canvas!
			</canvas>	
		</div>
		<script>

			var direction = {
	            RIGHT : 39,
	            LEFT  : 37,
	            UP    : 38,
	            DOWN  : 40
	        };

	        var sceneWidth = 400, sceneHeight = 330;

			var friction = 1.6;
			var gravity = 0.4;
			var bounce = 8;

			var player = SQUARE.createBox({id : 'player', x : 10, y : 250, width : 10, height : 10, fillStyle : '#FF0000', gravity : gravity});
			var box1 = SQUARE.createBox({ id : 'box1', x : 100, y : 295, width : 30, height : 20});
			var box2 = SQUARE.createBox({ id : 'box2', x : 150, y : 225, width : 30, height : 20});
			var box3 = SQUARE.createBox({ id : 'box3', x : 100, y : 180, width : 30, height : 20, velX : 1, velY : 0, isVisible : false });
			var box4 = SQUARE.createBox({ id : 'box4', x : 200, y : 120, width : 30, height : 20, velX : -1, velY : 0, isVisible : false});
			var key = SQUARE.createBox({ id : 'key', x : 350, y : 40, width : 20, height : 50, fillStyle : '#008000'});
			var winnerText = SQUARE.createText( {id : 'winnerText', text : 'you win!', x : sceneWidth / 2, y : sceneHeight / 2, font : 'bold 24px cursive sans-serif', isVisible : false});
			var circle1 = SQUARE.createCircle({id : 'circle1', x : 30, y : 300, radius : 10});

			var renderer = SQUARE.getRenderer('mycanvas');

			var scene = SQUARE.createScene();
			scene.activeBorder(true);

			scene.addChild(player).addChild(box1).addChild(box2).addChild(box3).addChild(box4).addChild(key).addChild(winnerText).addChild(circle1);
			
			scene.when(player).onCollisionWith([box1, box2, box3, box4]).then(function(info) {
				if (info.where === 'bottom') {
					player.velY = -player.velY;
				}

				if (info.where === 'top') {
					player.isJumping = false;
					player.position.y = info.collisioner.position.y - player.height;
					player.position.x += info.collisioner.velX;
					player.velY = 0;
					if (info.collisioner.id === 'box2') {
						box3.isVisible = box4.isVisible = true;
					}
				}

				if (info.where === 'left') {
					player.isJumping = false;
					player.position.x = info.collisioner.position.x - player.width;
					player.velX = 0;
				}

				if (info.where === 'right') {
					player.isJumping = false;
					player.position.x = info.collisioner.position.x + info.collisioner.width;
					player.velX = 0;
				}
			});

			scene.when(player).onCollisionWith([key]).then(function(info) {
				winnerText.isVisible = true;
				info.collisioner.isVisible = false;
			});

			scene.when(player).onCollisionWith([circle1]).then(function(info) {

			});

			scene.when(box3).onCollisionWithBorder().then(function(info){
				if (info.where === 'borderLeft' || info.where === 'borderRight') {
					box3.velX = -box3.velX;
				}
			});

			scene.when(box4).onCollisionWithBorder().then(function(info){
				if (info.where === 'borderLeft' || info.where === 'borderRight') {
					box4.velX = -box4.velX;
				}
			});

			scene.when(player).onCollisionWithBorder().then(function(info) {
				if (info.where === 'borderLeft') {
					player.velX = 0;
					player.position.x = 0;
				}

				if (info.where === 'borderRight') {
					player.velX = 0;
					player.position.x = sceneWidth - player.width;
				}

				if (info.where === 'borderBottom') {
					player.velY = 0;
					player.position.y = sceneHeight - player.height;
					player.isJumping = false;
				}
			});

			function drawScene() {
				renderer.render(scene);

				requestAnimationFrame(drawScene);
			}

			window.addEventListener('keydown', function(e) {
				if (e.keyCode === direction.RIGHT) {
					player.velX = friction;
				}

				if (e.keyCode === direction.LEFT) {
					player.velX = -friction;
				}

				if (e.keyCode === direction.UP) {
					if (!player.isJumping) {
						player.velY = -bounce;
						player.isJumping = true;
					}
				}
			});

			window.addEventListener('keyup', function(e) {
				if (e.keyCode === direction.RIGHT || e.keyCode === direction.LEFT) {
					player.velX = 0;
				}
			});

		</script>
	</body>
</html>