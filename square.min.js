var SQUARE=function(e){e.createPosition=function(e){var t={};t.x=e.x;t.y=e.y;return t};e.createGameObject=function(e){var t={};var n=[];t.id=e.id||Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);t.position=this.createPosition({x:e.x,y:e.y});t.fillStyle=e.fillStyle||"none";t.velX=e.velX||0;t.velY=e.velY||0;t.gravity=e.gravity||0;t.isVisible=true;if(e.isVisible===false){t.isVisible=false}t.renderer=function(e){};return t};e.createBox=function(e){var t=this.createGameObject(e);t.width=e.width;t.height=e.height;t.halfWidth=t.width/2;t.halfHeight=t.height/2;t.getCenterPositionX=function(){return this.position.x+this.halfWidth};t.getCenterPositionY=function(){return this.position.y+this.halfHeight};var n=this.createBoxRenderer(t);t.render=function(e){n.render(e)};return t};e.createTriangle=function(t){var n=this.createGameObject(t);n.type="triangle";n.vertex1=this.createPosition(t.vertex1);n.vertex2=this.createPosition(t.vertex2);n.vertex3=this.createPosition(t.vertex3);n.directionVector1=null;n.directionVector2=null;n.commonVertex=null;(function(){function u(e){var t=e[0].length;var n=0;for(var r=0;r<e.length;r++){if(t<e[r].length){t=e[r].length;n=r}}return n}function l(e){var t=null;for(var n=0;n<f.length;n++){if(f[n].vertex===e){t=f[n];break}}return t}var r=[];var i={v1:t.vertex1,v2:t.vertex2,length:Math.sqrt((t.vertex2.x-t.vertex1.x)*(t.vertex2.x-t.vertex1.x)+(t.vertex2.y-t.vertex1.y)*(t.vertex2.y-t.vertex1.y))};var s={v1:t.vertex1,v2:t.vertex3,length:Math.sqrt((t.vertex3.x-t.vertex1.x)*(t.vertex3.x-t.vertex1.x)+(t.vertex3.y-t.vertex1.y)*(t.vertex3.y-t.vertex1.y))};var o={v1:t.vertex2,v2:t.vertex3,length:Math.sqrt((t.vertex3.x-t.vertex2.x)*(t.vertex3.x-t.vertex2.x)+(t.vertex3.y-t.vertex2.y)*(t.vertex3.y-t.vertex2.y))};r.push(i);r.push(s);r.push(o);var a=u(r);r.splice(a,1);var f=[];for(var c=0;c<r.length;c++){var h=l(r[c].v1);if(h===null){f.push({vertex:r[c].v1,count:1})}else{h.count++}h=l(r[c].v2);if(h===null){f.push({vertex:r[c].v2,count:1})}else{h.count++}}var p=f[0].count;for(var c=0;c<f.length;c++){if(p<f[c].count){p=f[c].count;n.commonVertex=f[c].vertex}}n.directionVector1=e.createPosition({x:r[0].v2.x-r[0].v1.x,y:r[0].v2.y-r[0].v1.y});n.directionVector2=e.createPosition({x:r[1].v2.x-r[1].v1.x,y:r[1].v2.y-r[1].v1.y})})();n.getProjectedVector=function(t,r){var i=(r.x*(t.x-n.commonVertex.x)+r.y*(t.y-n.commonVertex.y))/(r.x*r.x+r.y*r.y);var s=n.commonVertex.x+i*r.x;var o=n.commonVertex.y+i*r.y;return e.createPosition({x:s,y:o})};n.center={position:e.createPosition({x:(n.vertex1.x+n.vertex2.x+n.vertex3.x)/3,y:(n.vertex1.y+n.vertex2.y+n.vertex3.y)/3})};n.width=0;n.height=0;n.halfWidth=0;n.halfHeight=0;var r=this.createTriangleRenderer(n);n.render=function(e){r.render(e)};return n};e.createCircle=function(e){var t=this.createGameObject(e);t.type="circle";t.radius=e.radius;t.diameter=e.radius*2;t.halfWidth=t.radius;t.halfHeight=t.radius;t.getCenterPositionX=function(){return this.position.x};t.getCenterPositionY=function(){return this.position.y};var n=this.createCircleRenderer(t);t.render=function(e){n.render(e)};t.isInVoronoiRegion1=function(e){return this.position.x<e.position.x&&this.position.y<e.position.y};t.isInVoronoiRegion2=function(e){return this.position.x>e.position.x+e.width&&this.position.y<e.position.y};t.isInVoronoiRegion3=function(e){return this.position.x>e.position.x+e.width&&this.position.y>e.position.y+e.height};t.isInVoronoiRegion4=function(e){return this.position.x<e.position.x&&this.position.y>e.position.y+e.height};return t};e.createText=function(e){var t=this.createGameObject(e);t.text=e.text;t.font=e.font||"bold 12px sans-serif";t.fontColor=e.fontColor||"#000000";t.getCenterPositionX=function(){};t.getCenterPositionY=function(){};var n=this.createTextRenderer(t);t.render=function(e){n.render(e)};return t};return e}(SQUARE||{});var SQUARE=function(e){e.createScene=function(){function i(e){var n;for(var r=0;r<t.children.length;r++){if(t.children[r].id===e.id){n=t.children[r];break}}return n}var t={};t.backgroundColor={startingColor:"#ffffff",endingColor:"#ffffff",mode:"vertical"};t.children=[];var n=false;var r=e.getCollisionManager();t.keyboard={create:function(){var e={};e.when=function(e){var t=this;return{then:function(t){window.addEventListener(e,t)}}};return e}};t.activeBorder=function(e){r.setBorderCollisionModeOn(e)};t.setGradientBackgroundColor=function(e){this.backgroundColor=e};t.setBackgroundColor=function(e){this.backgroundColor.startingColor=this.backgroundColor.endingColor=e};t.pause=function(){n=!n};t.isPaused=function(){return n};t.addChild=function(e){if(!i(e)){this.children.push(e)}return this};t.removeChild=function(e){var t;for(var n=0;n<this.children.length;n++){if(this.children[n].id===obj.id){t=n;break}}if(t){this.children.splice(t,1)}};t.check=function(e){r.check(e)};t.when=function(e){return{onCollisionWith:function(t){return{then:function(n){r.registerBehaviour({subject:e,objects:t,callback:n})}}},onCollisionWithBorder:function(){return{then:function(t){r.registerBehaviourForBorder({subject:e,callback:t})}}}}};return t};return e}(SQUARE||{});var SQUARE=function(e){e.getCollisionManager=function(){function s(e){var t={};t.collisionObjects=e.collisionObjects;t.callback=e.callback;t.isForBorder=e.isForBorder;return t}function o(e){if(n){return e.position.x<n.minX}return false}function u(e){if(n){return e.position.x+e.width>n.x}return false}function a(e){if(n){return e.position.y+e.height>n.y}return false}function f(e){if(n){return e.position.y<n.minY}return false}function l(e,t){var n=e.getCenterPositionX();var r=t.getCenterPositionX();var i=e.halfWidth+t.halfWidth-Math.abs(n-r);if(i<=0){return""}var s=e.getCenterPositionY();var o=t.getCenterPositionY();var u=e.halfHeight+t.halfHeight-Math.abs(s-o);if(u<=0){return""}if(i<u){if(n-r<0){return"left"}return"right"}else{if(s-o<0){return"top"}return"bottom"}}function c(t,n){var r=n.isInVoronoiRegion1(t);if(r===true){var i=e.createPosition({x:t.position.x,y:t.position.y});var s=Math.abs(n.position.x-i.x);var o=Math.abs(n.position.y-i.y);if(s<n.radius&&o<n.radius){return"bottom"}}else{var u=n.isInVoronoiRegion2(t);if(u===true){var i=e.createPosition({x:t.position.x+t.width,y:t.position.y});var s=Math.abs(n.position.x-i.x);var o=Math.abs(n.position.y-i.y);if(s<n.radius&&o<n.radius){return"bottom"}}else{var a=n.isInVoronoiRegion3(t);if(a===true){var i=e.createPosition({x:t.position.x+t.width,y:t.position.y+t.width});var s=Math.abs(n.position.x-i.x);var o=Math.abs(n.position.y-i.y);if(s<n.radius&&o<n.radius){return"top"}}else{var f=n.isInVoronoiRegion4(t);if(f===true){var i=e.createPosition({x:t.position.x,y:t.position.y+t.width});var s=Math.abs(n.position.x-i.x);var o=Math.abs(n.position.y-i.y);if(s<n.radius&&o<n.radius){return"top"}}else{return l(t,n)}}}}return""}function h(t,n){var r=null;var i=null;var s=null;var o=false;if(n.center.position.x>t.getCenterPositionX()){r=n.directionVector1;i=t.position;s=e.createPosition({x:t.position.x+t.width,y:t.position.y+t.height});position1=n.getProjectedVector(i,r);position2=n.getProjectedVector(s,r);o=position2.x>n.commonVertex.x&&position2.y>n.commonVertex.y}else{r=n.directionVector2;i=e.createPosition({x:t.position.x,y:t.position.y+t.height});s=e.createPosition({x:t.position.x+t.width,y:t.position.y});position1=n.getProjectedVector(i,r);position2=n.getProjectedVector(s,r);o=position1.x<n.commonVertex.x&&position1.y>n.commonVertex.y}var u=n.position.x<t.position.x+t.width;var a=n.position.y<t.position.y+t.height;if(o&&u||o&&a){return"left"}return""}function p(e,t){if(t.type==="circle"){return c(e,t)}else if(t.type==="triangle"){return h(e,t)}else{return l(e,t)}}var t={};var n;var r=[];var i=[];t.setBorderCollisionModeOn=function(e){if(e){n={};n.minX=0;n.x=sceneWidth;n.minY=0;n.y=sceneHeight}else{delete n}};t.getCollisionBorderInformation=function(e){if(u(e)){return"borderRight"}if(o(e)){return"borderLeft"}if(a(e)){return"borderBottom"}if(f(e)){return"borderTop"}return""};t.getCollisionObjectInformation=function(e,t){return p(e,t)};t.check=function(e){var t=this;var n;var r=d(e);if(r){var i="";r.behaviours.forEach(function(n){if(!n.isForBorder){n.collisionObjects.forEach(function(r){if(r.isVisible){i=t.getCollisionObjectInformation(e,r);if(i!==""){n.callback({collisioner:r,where:i})}}})}else{i=t.getCollisionBorderInformation(e);if(i!==""&&n.callback){n.callback({where:i})}}})}};t.registerBehaviourForBorder=function(e){var t=d(e.subject);if(!t){t={};t=e.subject;t.behaviours=[];i.push(t)}t.behaviours.push(s({collisionObjects:[],callback:e.callback,isForBorder:true}))};var d=function(e){var t=null;for(var n=0;n<i.length;n++){if(i[n].id===e.id){t=i[n];break}}return t};t.registerBehaviour=function(e){var t=d(e.subject);if(!t){t={};t=e.subject;t.behaviours=[];i.push(t)}t.behaviours.push(s({collisionObjects:e.objects,callback:e.callback,isForBorder:false}))};return t};return e}(SQUARE||{});var SQUARE=function(e){e.getRenderer=function(e){var t=document.getElementById(e);var n=t.getContext("2d");var r={};r.render=function(e){n.clearRect(0,0,t.width,t.height);n.rect(0,0,t.width,t.height);var r;if(e.backgroundColor.mode==="horizontal"){r=n.createLinearGradient(0,0,0,t.height)}else{r=n.createLinearGradient(0,0,t.width,0)}r.addColorStop(0,e.backgroundColor.startingColor);r.addColorStop(1,e.backgroundColor.endingColor);n.fillStyle=r;n.fill();for(var i=0;i<e.children.length;i++){if(!e.isPaused()&&e.children[i].isVisible){e.children[i].velY+=e.children[i].gravity;e.children[i].position.x+=e.children[i].velX;e.children[i].position.y+=e.children[i].velY;e.check(e.children[i]);e.children[i].render(n)}else{if(e.isPaused()&&e.children[i].isVisible){e.children[i].render(n)}}}};return r};e.createBoxRenderer=function(e){var t={};t.render=function(t){t.beginPath();if(e.fillStyle!=="none"){t.fillStyle=e.fillStyle;t.fillRect(e.position.x,e.position.y,e.width,e.height)}else{t.rect(e.position.x,e.position.y,e.width,e.height)}t.closePath();t.stroke()};return t};e.createTriangleRenderer=function(e){var t={};t.render=function(t){t.beginPath();t.moveTo(e.position.x,e.position.y);t.lineTo(e.vertex1.x,e.vertex1.y);t.lineTo(e.vertex2.x,e.vertex2.y);t.lineTo(e.vertex3.x,e.vertex3.y);if(e.fillStyle!=="none"){t.fillStyle=e.fillStyle;t.fill()}else{t.stroke()}};return t};e.createTextRenderer=function(e){var t={};t.render=function(t){t.font=e.font;t.fillStyle=e.fontColor;t.fillText(e.text,e.position.x,e.position.y)};return t};e.createCircleRenderer=function(e){var t={};t.render=function(t){t.beginPath();t.arc(e.position.x,e.position.y,e.radius,0,2*Math.PI,false);t.closePath();if(e.fillStyle!=="none"){t.fillStyle="green"}t.fill()};return t};return e}(SQUARE||{})